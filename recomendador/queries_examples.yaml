version: 1
alpha: 0.6  # peso del margen en el score (0..1). La rotación pesa (1 - alpha).

# Filtros globales (se aplican a TODAS las consultas)
global_filters:
  margin_cap_ratio: 0.3
  sold_only: true
  max_year_gap: 3
  fuel_exclude: []

# Sensores de demanda
demand:
  use_brand_share: true
  use_units_abs: true
  use_concentration_penalty: false
  weight_brand_share: 0.2
  weight_units_abs: 0.8
  weight_concentration: 0.0

# Lista de consultas
queries:
  # ---------------- Q1 ----------------
  - name: "Q1 - Mejor subasta para BMW X1 (Top 20)"
    type: q1
    model: "X1"
    region: esp
    top_n: 20
    filters:
      min_year: 2018        # <— tu runner entiende min/max_year
      max_year: 2024
      mileage_max: 120000

  # ---------------- Q2 ----------------
  - name: "Q2 - Orden de precio dentro de BMW (vehículo óptimo por modelo)"
    type: q2
    brand: "BMW"
    region: bcn
    mode: cheapest          # cheapest = más barato por modelo_base_x; max_margin = mayor margen
    filters:
      min_year: 2020
      max_km: 100000

  # ---------------- Q3 ----------------
  - name: "Q3 - Orden de precio en segmento SUV compacto (Top 20)"
    type: q3
    segment: "SUV compacto"
    region: esp
    top_n: 20
    mode: cheapest   # mode: max_margin (alternativa)    # orden por precio_final_eur asc (por defecto)
    filters:
      min_year: 2020
      max_year: 2025
      max_km: 100000
      fuel_include: ["GASOLINA", "DIESEL"]

      
  # ---------------- Q4 ----------------
  - name: "Q4 - Atractivo Golf 2.0 TDI 2020 DIESEL (BCN)"
    type: q4
    region: bcn            # por defecto bcn, pero puedes poner cat o esp
    modelo_base: "GOLF"
    year: 2020             # opcional; si lo quitas usará el rango de filters
    fuel: "DIESEL"         # opcional; si lo quitas usa todos los fuels
    filters:
      min_year: 2020       # por defecto 2020
      max_year: 2024       # por defecto 2024
      # fuel_include: ["DIESEL","GASOLINA"]  # opcional; normalmente basta con 'fuel' arriba

  # ---------------- Q5 ----------------
  - name: "Q5 - Mejor fuel vs resto para BMW X1 2021"
    type: q5
    modelo_base: "X1"   # se usará contra la columna modelo_base_x
    year: 2021          # también acepta anio / año

  # ---------------- Consulta genérica (legacy compatible) ----------------
  - name: "GEN - X1 <= 6 años, <=15k, <=120k km, DIESEL, BCN"
    type: generic
    region: bcn
    top_n: 20
    selection: max_margin   # o cheapest / mean
    filters:
      modelo_base: "X1"
      max_age_years: 6
      max_price: 15000
      max_km: 120000
      fuel_include: ["DIESEL"]
      segment_include: ["SUV compacto"]
      gearbox: automatic
      min_year: 2019
      max_year: 2024
  # ---------------- Plantilla genérica completa ----------------
  - name: "GEN - Plantilla completa (modificar a gusto)"
    type: generic

    # --- parámetros generales ---
    region: bcn                 # bcn / cat / esp → región usada en el score
    top_n: 20                   # nº máximo de filas a devolver
    selection: cheapest         # cheapest | max_margin | mean

    prefer_fast: false          # true = boost de rotación (rotation_boost=0.3)
    ignore_rotation: false      # true = score solo por margen (alpha=1.0)
    brand_only: false           # (hoy sin uso real; reservado)

    min_listings_per_group: 1   # mínimo de lotes por cluster
    prefer_cheapest_sort: false # matiz en orden final (se usa poco)

    cluster:
      include_sale_country: true  # si el cluster distingue país de subasta
      include_sale_name: true     # si el cluster distingue nombre de subasta

    # --- filtros específicos de esta query ---
    filters:

      # EDAD / AÑO
      max_age_years: 6           # edad máxima (años desde hoy; usa columna anio)
      year_exact: [2020, 2021]   # año(s) exactos; también puede ser un solo int

      # PRECIO
      min_price: 5000            # precio_final_eur >= 5000
      max_price: 15000           # precio_final_eur <= 15000

      # KILOMETRAJE
      mileage_min: 20000         # km mínimos
      mileage_max: 120000        # km máximos
      max_km: 120000             # alias de mileage_max

      # FUEL (usa combustible_norm / fuel_type normalizado)
      fuel_include: ["DIESEL", "GASOLINA"]    # incluir solo estos combustibles
      fuel_exclude: ["BEV", "PHEV"]           # excluir estos combustibles
      combustible_include: []                 # alias de fuel_include
      combustible_exclude: []                 # alias de fuel_exclude

      # CAJA DE CAMBIOS
      gearbox: automatic          # automatic / manual (se mira en transmission)
      transmission: automatic     # alias de gearbox

      # SEGMENTO (segmento / segment / segmento_norm)
      segment: ["SUV compacto"]   # incluir estos segmentos
      segment_include: []         # alias de segment
      segment_exclude: ["LUXURY"] # excluir segmentos

      # NOTA: la generic actual NO usa aún min_year/max_year ni modelo_base_x.
      # Esos filtros están en Q1–Q3–Q5 o habrá que añadirlos si los queremos aquí.

